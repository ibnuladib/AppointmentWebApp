@using Microsoft.AspNetCore.Identity
@model IEnumerable<ApplicationUser>

@{
    ViewData["Title"] = "Search Doctors";
}

<h1>@ViewData["Title"]</h1>


    <div class="input-group">
        <input type="text" class="form-control" name="searchString" id="searchBox" placeholder="Search by ID, Name, Specialization, or Email" autocomplete="off" style="width: 300px;" />
    <button class="btn btn-secondary ms-2" onclick="window.location.href='@Url.Action("Index")?searchString=' + document.getElementById('searchBox').value">Search</button>

        <div class="dropdown ms-2">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="specializationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Specialization
            </button>
            <ul class="dropdown-menu" aria-labelledby="specializationDropdown">
                <li><a class="dropdown-item" href="@Url.Action("Index")">All Specializations</a></li>
                @foreach (var item in ViewBag.SpecializationCounts)
                {
                    <li>
                        <a class="dropdown-item" href="@Url.Action("Index", new { specialization = item.Specialization })">
                            @item.Specialization (@item.Count)
                        </a>
                    </li>
                }
            </ul>

        </div>
    <!-- Filter by Rating, preserving search and specialization -->
    <button class="btn btn-secondary ms-2"
            onclick="window.location.href='@Url.Action("Index", new { searchString = ViewBag.SearchString, specialization = ViewBag.Specialization, filterBy = "rating" })'">
        Filter by Rating
    </button>

    <!-- Filter by Experience, preserving search and specialization -->
    <button class="btn btn-secondary ms-2"
            onclick="window.location.href='@Url.Action("Index", new { searchString = ViewBag.SearchString, specialization = ViewBag.Specialization, filterBy = "experience" })'">
        Filter by Experience
    </button>

    </div>



<div id="suggestions" class="list-group"></div>

@if (Model.Any())
{
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                
                <th>Name</th>
                <th>Specialization</th>
                <th>Rating</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model)
            {
                <tr class="clickable-row" data-id="@user.Id">
                    <td>@user.Id</td>
                    <td>@user.UserName</td>
                    
                    <td>@user.FirstName @user.LastName</td>
                    <td>@user.Specialization</td>
                    <td>@user.AverageRating</td>
                    <td>
                        <a asp-controller="Users" asp-action="UserDetails" asp-route-id="@user.Id" class="btn btn-primary">Details</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No doctors found.</p>
}
<style>
    <style >
    .clickable-row {
        cursor: pointer;
    }
</style>
</style>
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Handle search box input and suggestions
            $('#searchBox').on('input', function () {
                var query = $(this).val();
                if (query.length > 1) {
                    $.ajax({
                        url: '@Url.Action("GetSuggestions", "Search")',
                        data: { query: query },
                        success: function (data) {
                            var suggestionsList = $('#suggestions');
                            suggestionsList.empty();
                            data.forEach(function (suggestion) {
                                var suggestionItem = '<a href="#" class="list-group-item list-group-item-action" data-id="' + suggestion.id + '">' + suggestion.firstName + ', ' + suggestion.lastName + ' (' + suggestion.specialization + ')</a>';
                                suggestionsList.append(suggestionItem);
                            });
                        }
                    });
                } else {
                    $('#suggestions').empty();
                }
            });

            $(document).on('click', '.list-group-item', function (e) {
                e.preventDefault();
                var id = $(this).data('id');
                window.location.href = '@Url.Action("UserDetails", "Users")' + '?id=' + id;
            });

            $('.clickable-row').on('click', function () {
                var id = $(this).data('id');
                window.location.href = '@Url.Action("UserDetails", "Users")' + '?id=' + id;
            });
        });
    </script>
}
